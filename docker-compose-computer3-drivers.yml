# ============================================================================
# COMPUTER 3 - Drivers (Manual + Auto) + DRIVER REGISTRY SERVICE
# ============================================================================
# INSTRUCTIONS:
# 1. Replace IP_CENTRAL with Computer 1's IP address
# 2. Start AFTER Computer 1 is fully running (wait ~30 seconds)
# 3. Build: docker-compose -f docker-compose-computer3-drivers.yml build
# 4. Start: docker-compose -f docker-compose-computer3-drivers.yml up
# ============================================================================

services:
  # Driver Registry Service (on PC3)
  driver_registry:
    build:
      context: .
      dockerfile: Dockerfile.registry
    container_name: driver_registry
    ports:
      - "5001:5001"
    volumes:
      - ./data:/app/data
    network_mode: host

  # Manual Driver 1
  driver_1:
    build:
      context: .
      dockerfile: Dockerfile.driver
    container_name: driver_1
    depends_on:
      - driver_registry
    environment:
      KAFKA_BROKER: 172.20.41.11:9092
    command: python driver/ev_driver.py DRIVER-001 172.20.41.11 5000
    network_mode: host
    stdin_open: true
    tty: true

  # Manual Driver 2
  driver_2:
    build:
      context: .
      dockerfile: Dockerfile.driver
    container_name: driver_2
    depends_on:
      - driver_registry
    environment:
      KAFKA_BROKER: 172.20.41.11:9092
    command: python driver/ev_driver.py DRIVER-002 172.20.41.11 5000
    network_mode: host
    stdin_open: true
    tty: true

  # Automated Driver (from file)
  driver_auto:
    build:
      context: .
      dockerfile: Dockerfile.driver
    container_name: driver_auto
    depends_on:
      - driver_registry
    environment:
      KAFKA_BROKER: 172.20.41.11:9092
    command: sh -c 'sleep 5 && python driver/ev_driver_auto.py DRIVER-AUTO 172.20.41.11 5000 data/charging_requests.txt'
    volumes:
      - ./data:/app/data
    network_mode: host