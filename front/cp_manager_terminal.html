<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CP Manager Terminal - EV Charging System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;500;600&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://code.iconify.design/3/3.1.0/iconify.min.js"></script>
    <style>
        @keyframes blink { 0%, 50% { opacity: 1; } 51%, 100% { opacity: 0; } }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(168, 85, 247, 0.3); } 50% { box-shadow: 0 0 40px rgba(168, 85, 247, 0.6); } }
        .terminal-cursor { animation: blink 1s step-end infinite; }
        .terminal-output { font-family: 'JetBrains Mono', monospace; white-space: pre-wrap; }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .glass { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.05); }
        
        /* ANSI Color Support */
        .ansi-white { color: #ffffff; }
        .ansi-green { color: #10b981; }
        .ansi-red { color: #ef4444; }
        .ansi-blue { color: #3b82f6; }
        .ansi-yellow { color: #f59e0b; }
        .ansi-cyan { color: #06b6d4; }
        .ansi-purple { color: #a855f7; }
    </style>
</head>
<body class="bg-neutral-950 text-neutral-100 h-screen overflow-hidden flex flex-col" style="font-family: 'Inter', sans-serif;">
    
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 flex-1 flex flex-col min-h-0">
        
        <!-- Header -->
        <header class="flex items-center justify-between mb-10">
            <div class="flex items-center gap-3 group">
                <div class="w-10 h-10 bg-gradient-to-br from-purple-400 to-purple-600 rounded-xl flex items-center justify-center pulse-glow transition-transform group-hover:scale-110">
                    <span class="iconify text-white" data-icon="lucide:terminal" data-width="22" data-height="22"></span>
                </div>
                <div>
                    <span class="text-xl font-bold tracking-tight bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">CP Manager Terminal</span>
                    <p class="text-xs text-neutral-500">Live WebSocket Connection</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <div id="connection-status" class="flex items-center gap-2 glass rounded-full px-4 py-2">
                    <div class="w-2 h-2 bg-red-500 rounded-full" id="status-indicator"></div>
                    <span class="text-xs text-neutral-400" id="status-text">Disconnected</span>
                </div>
                <a href="index.html" class="glass rounded-full px-4 py-2 hover:bg-white/10 transition-all hover:scale-105 active:scale-95 flex items-center gap-2">
                    <span class="iconify text-emerald-400" data-icon="lucide:home" data-width="18" data-height="18"></span>
                    <span class="text-sm font-medium hidden sm:inline">Dashboard</span>
                </a>
            </div>
        </header>

        <!-- Terminal Window -->
        <div class="glass rounded-2xl flex flex-col" style="width:578.81px; height:469px;">
            <!-- Terminal Titlebar -->
            <div class="bg-neutral-900 px-4 py-2 flex items-center justify-between border-b border-neutral-800">
                <div class="flex items-center gap-2">
                    <div class="flex gap-2">
                        <div class="w-3 h-3 rounded-full bg-red-500/80"></div>
                        <div class="w-3 h-3 rounded-full bg-amber-500/80"></div>
                        <div class="w-3 h-3 rounded-full bg-emerald-500/80"></div>
                    </div>
                    <span class="text-xs text-neutral-500 ml-2">evcharging_cp_manager - WebSocket Terminal</span>
                </div>
                <button onclick="clearTerminal()" class="text-xs text-neutral-500 hover:text-neutral-300 transition">
                    <span class="iconify" data-icon="lucide:trash-2" data-width="14" data-height="14"></span>
                </button>
            </div>
            
            <!-- Terminal Output -->
            <div id="terminal-output" class="terminal-output text-sm p-4 flex-1 min-h-0 overflow-y-auto bg-neutral-950 text-emerald-400">
                <div class="text-neutral-500">Connecting to CP Manager...</div>
            </div>
            
            <!-- Terminal Input -->
            <div class="bg-neutral-900 border-t border-neutral-800 p-3 flex items-center gap-2">
                <span class="text-emerald-400 text-sm terminal-output">evcharging@manager:~$</span>
                <input 
                    type="text" 
                    id="terminal-input" 
                    class="flex-1 bg-transparent text-emerald-400 text-sm outline-none terminal-output"
                    placeholder="Type command..."
                    autocomplete="off"
                    onkeypress="handleInput(event)"
                    disabled
                >
                <span class="terminal-cursor text-emerald-400 text-sm">▊</span>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="mt-4 grid grid-cols-2 sm:grid-cols-4 gap-2">
            <button onclick="sendCommand('1')" class="glass rounded-lg px-3 py-2 text-xs hover:bg-emerald-500/10 transition-all flex items-center gap-2">
                <span class="iconify text-emerald-400" data-icon="lucide:plus-circle" data-width="14" data-height="14"></span>
                Create CP
            </button>
            <button onclick="sendCommand('2')" class="glass rounded-lg px-3 py-2 text-xs hover:bg-red-500/10 transition-all flex items-center gap-2">
                <span class="iconify text-red-400" data-icon="lucide:trash-2" data-width="14" data-height="14"></span>
                Delete CP
            </button>
            <button onclick="sendCommand('3')" class="glass rounded-lg px-3 py-2 text-xs hover:bg-blue-500/10 transition-all flex items-center gap-2">
                <span class="iconify text-blue-400" data-icon="lucide:list" data-width="14" data-height="14"></span>
                List CPs
            </button>
            <button onclick="sendCommand('help')" class="glass rounded-lg px-3 py-2 text-xs hover:bg-purple-500/10 transition-all flex items-center gap-2">
                <span class="iconify text-purple-400" data-icon="lucide:help-circle" data-width="14" data-height="14"></span>
                Help
            </button>
        </div>

    </div>

    <script>
        let ws = null;
        const terminalOutput = document.getElementById('terminal-output');
        const terminalInput = document.getElementById('terminal-input');
        const statusIndicator = document.getElementById('status-indicator');
        const statusText = document.getElementById('status-text');

        // ANSI color code regex
        const ansiRegex = /\033\[(\d+)m/g;
        const colorMap = {
            '37': 'ansi-white',
            '92': 'ansi-green',
            '91': 'ansi-red',
            '94': 'ansi-blue',
            '93': 'ansi-yellow',
            '96': 'ansi-cyan',
            '95': 'ansi-purple',
            '0': 'ansi-white'
        };

        function parseANSI(text) {
            // Convert ANSI codes to HTML spans
            let result = '';
            let lastIndex = 0;
            let currentClass = 'ansi-white';
            
            text.replace(ansiRegex, (match, code, index) => {
                // Add text before this code
                if (index > lastIndex) {
                    result += `<span class="${currentClass}">${escapeHtml(text.substring(lastIndex, index))}</span>`;
                }
                
                // Update current color
                currentClass = colorMap[code] || 'ansi-white';
                lastIndex = index + match.length;
                
                return '';
            });
            
            // Add remaining text
            if (lastIndex < text.length) {
                result += `<span class="${currentClass}">${escapeHtml(text.substring(lastIndex))}</span>`;
            }
            
            return result || `<span class="${currentClass}">${escapeHtml(text)}</span>`;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function printToTerminal(text) {
            if (text === '[CLEAR]') {
                terminalOutput.innerHTML = '';
                return;
            }
            
            const line = document.createElement('div');
            line.innerHTML = parseANSI(text);
            terminalOutput.appendChild(line);
            terminalOutput.scrollTop = terminalOutput.scrollHeight;
        }

        function connectWebSocket() {
            terminalOutput.innerHTML = '<div class="text-neutral-500">Connecting to CP Manager WebSocket...</div>';
            
            ws = new WebSocket('ws://localhost:8082');
            
            ws.onopen = () => {
                statusIndicator.className = 'w-2 h-2 bg-emerald-500 rounded-full animate-pulse';
                statusText.textContent = 'Connected';
                terminalInput.disabled = false;
                terminalInput.focus();
            };
            
            ws.onmessage = (event) => {
                printToTerminal(event.data);
            };
            
            ws.onerror = (error) => {
                printToTerminal('\033[91m❌ WebSocket error. Is the CP Manager container running?\033[0m');
                statusIndicator.className = 'w-2 h-2 bg-red-500 rounded-full';
                statusText.textContent = 'Error';
            };
            
            ws.onclose = () => {
                statusIndicator.className = 'w-2 h-2 bg-amber-500 rounded-full';
                statusText.textContent = 'Disconnected';
                terminalInput.disabled = true;
                printToTerminal('\033[93m⚠️ Connection lost. Reconnecting in 3 seconds...\033[0m');
                setTimeout(connectWebSocket, 3000);
            };
        }

        function sendCommand(cmd) {
            if (ws && ws.readyState === WebSocket.OPEN) {
                ws.send(cmd);
                terminalInput.value = '';
            }
        }

        function handleInput(event) {
            if (event.key === 'Enter') {
                const command = terminalInput.value.trim();
                if (command) {
                    sendCommand(command);
                }
            }
        }

        function clearTerminal() {
            terminalOutput.innerHTML = '';
        }

        // Connect on load
        window.addEventListener('load', () => {
            connectWebSocket();
        });
    </script>
</body>
</html>